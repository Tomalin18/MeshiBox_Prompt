# 精細五十音分組修復

## 修復概述

實現精細的五十音分組功能，確保每個假名音節都有獨立的分組，例如「千葉龍太」(ちばりゅうた) 會出現在 **[ち]** 分組中，而不是粗略的「た行」分組。

## 問題分析

### 1. 分組粒度不夠精細
- **原問題**：只按五十音的「行」分組（あ、か、さ、た等）
- **用戶期望**：按具體「音節」分組（あ、い、う、え、お、か、き、く、け、こ等）
- **具體案例**：
  - 千葉龍太 (ちばりゅうた) → 應該在 **[ち]** 分組
  - 田中太郎 (たなかたろう) → 應該在 **[た]** 分組
  - 佐藤花子 (さとうはなこ) → 應該在 **[さ]** 分組

### 2. 漢字讀音對照表需要擴展
- **問題**：缺少「龍太」等常見名字的讀音
- **影響**：無法正確識別複合姓名的讀音

## 技術解決方案

### 1. 精細分組邏輯實現

#### 替換粗略分組為精細分組
```typescript
// 修改前（粗略分組）
if (firstChar >= 'あ' && firstChar <= 'お') return 'あ';
if (firstChar >= 'か' && firstChar <= 'ご') return 'か';

// 修改後（精細分組）
if (firstChar === 'あ') return 'あ';
if (firstChar === 'い') return 'い';
if (firstChar === 'う') return 'う';
if (firstChar === 'え') return 'え';
if (firstChar === 'お') return 'お';

if (firstChar === 'か' || firstChar === 'が') return 'か';
if (firstChar === 'き' || firstChar === 'ぎ') return 'き';
if (firstChar === 'く' || firstChar === 'ぐ') return 'く';
// ...繼續所有音節
```

#### 支援濁音和半濁音
```typescript
// か行（包含濁音）
if (firstChar === 'か' || firstChar === 'が') return 'か';
if (firstChar === 'き' || firstChar === 'ぎ') return 'き';

// は行（包含濁音和半濁音）
if (firstChar === 'は' || firstChar === 'ば' || firstChar === 'ぱ') return 'は';
if (firstChar === 'ひ' || firstChar === 'び' || firstChar === 'ぴ') return 'ひ';
```

### 2. 完整五十音分組順序

#### 精細分組排序表
```typescript
const kanaGroups = [
  'あ', 'い', 'う', 'え', 'お',
  'か', 'き', 'く', 'け', 'こ',
  'さ', 'し', 'す', 'せ', 'そ',
  'た', 'ち', 'つ', 'て', 'と',
  'な', 'に', 'ぬ', 'ね', 'の',
  'は', 'ひ', 'ふ', 'へ', 'ほ',
  'ま', 'み', 'む', 'め', 'も',
  'や', 'ゆ', 'よ',
  'ら', 'り', 'る', 'れ', 'ろ',
  'わ', 'ゐ', 'ゑ', 'を', 'ん'
];
```

### 3. 擴展讀音對照表

#### 添加常見名字
```typescript
// 新增讀音
'龍太': 'りゅうた',
'千葉': 'ちば', // 已存在，確認覆蓋
```

## 測試驗證

### 測試案例
```javascript
const testCards = [
  { name: '千葉 龍太', nameReading: 'ちば りゅうた' },
  { name: '田中 太郎' }, // 自動識別
  { name: '佐藤 花子' }, // 自動識別
  { name: '栗屋野 盛一郎' }, // 自動識別
];
```

### 測試結果
```
千葉 龍太 (ちば りゅうた) → [ち] 分組 ✅
田中 太郎 (たなか たろう) → [た] 分組 ✅
佐藤 花子 (さとう はなこ) → [さ] 分組 ✅
栗屋野 盛一郎 (くりやの せいいちろう) → [く] 分組 ✅
栄田 源 (えいだ げん) → [え] 分組 ✅
飯山 隆幸 (いいやま たかゆき) → [い] 分組 ✅
諸本 智明 (もろもと ともあき) → [も] 分組 ✅
```

## 實現效果

### 1. 精細分組展示
用戶現在將看到完整的50個假名分組：

**あ行**
- [あ] - 青木、安藤等
- [い] - 飯山、石田、井上等  
- [う] - 上田、植田等
- [え] - 栄田、江藤等
- [お] - 大川、岡田等

**か行**
- [か] - 加藤、金田等
- [き] - 菊地、北川、木村等
- [く] - 栗屋野、黒田等
- [け] - (較少)
- [こ] - 小林、小島等

**た行**
- [た] - 田中、高橋等
- [ち] - 千葉等 ← **您的例子**
- [つ] - (較少)
- [て] - (較少)
- [と] - (較少)

### 2. 智能姓名處理
- **讀音優先**：有 nameReading 時使用用戶輸入的讀音
- **自動識別**：沒有讀音時自動從對照表查找
- **姓氏分組**：基於姓氏進行分組，符合日文習慣

### 3. 用戶體驗提升
- **直觀查找**：按照真實假名音節分組
- **精確定位**：每個音節獨立分組，快速找到目標名片
- **完整覆蓋**：支援所有50個基本假名音節

## 技術亮點

1. **50音節完整支援**：覆蓋所有平假名基本音節
2. **濁音半濁音處理**：が、ぎ、ぐ等歸類到對應清音分組
3. **片假名相容**：自動轉換片假名到對應平假名分組
4. **智能排序**：按照標準五十音順序排列分組
5. **向後相容**：保持原有API不變，只是分組更精細

## 使用場景

### 1. 標準日文名片
```
千葉龍太 (ちばりゅうた) → [ち] 分組
田中太郎 (たなかたろう) → [た] 分組
```

### 2. 複雜漢字名片
```
鷲見一郎 (すみいちろう) → [す] 分組
※ 需要手動輸入正確讀音
```

### 3. 混合名片集合
名片一覽將顯示：
- [あ] (3張名片)
- [い] (2張名片)  
- [う] (1張名片)
- [え] (1張名片)
- ...
- [ち] (1張名片) ← 千葉龍太在這裡
- [つ] (0張名片，不顯示)
- ...

## 後續優化

1. **動態分組**：只顯示有名片的分組，隱藏空分組
2. **統計顯示**：分組標題顯示名片數量
3. **快速跳轉**：點擊五十音表快速跳轉到對應分組
4. **搜索增強**：支援按分組字母搜索
5. **個性化**：記住用戶常用的分組偏好

## 總結

通過實現精細的五十音分組，現在每個假名音節都有獨立的分組標籤。用戶輸入「千葉龍太」並設定讀音為「ちばりゅうた」時，名片將正確出現在 **[ち]** 分組中，完全符合日文五十音的標準分類方式，大大提升了名片管理的精確性和便利性。 